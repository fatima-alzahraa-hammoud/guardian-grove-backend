dca3991eb781e95b64cf8b00a4bc0645
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.testUtils = void 0;
// Global test setup for Guardian Grove project
const dotenv_1 = require("dotenv");
// Load test environment variables from .env.test
(0, dotenv_1.config)({ path: '.env.test' });
// Set test timeout (10 seconds for database operations)
jest.setTimeout(10000);
// Global cleanup after each test
afterEach(() => {
    jest.clearAllMocks();
});
// Set required environment variables for your app
process.env.NODE_ENV = 'test';
// Ensure these are set even if .env.test is missing some values
if (!process.env.JWT_SECRET) {
    process.env.JWT_SECRET = 'test-jwt-secret-fallback';
}
if (!process.env.EMAIL_USERNAME) {
    process.env.EMAIL_USERNAME = 'test@guardiangrove.com';
}
if (!process.env.EMAIL_PASSWORD) {
    process.env.EMAIL_PASSWORD = 'test-password';
}
if (!process.env.MONGO_URI) {
    process.env.MONGO_URI = 'mongodb://localhost:27017/guardian_grove_test';
}
if (!process.env.PORT) {
    process.env.PORT = '3001';
}
// Export test utilities
exports.testUtils = {
    // Create mock Express request object
    createMockRequest: (overrides = {}) => (Object.assign({ body: {}, params: {}, query: {}, headers: {}, user: null }, overrides)),
    // Create mock Express response object with all methods your controllers use
    createMockResponse: () => {
        const res = {};
        res.status = jest.fn().mockReturnValue(res);
        res.json = jest.fn().mockReturnValue(res);
        res.send = jest.fn().mockReturnValue(res);
        res.cookie = jest.fn().mockReturnValue(res);
        res.clearCookie = jest.fn().mockReturnValue(res);
        res.redirect = jest.fn().mockReturnValue(res);
        return res;
    },
    // Create mock user based on your actual User model structure
    createMockUser: (overrides = {}) => (Object.assign({ _id: '507f1f77bcf86cd799439011', name: 'Test User', email: 'test@example.com', isTempPassword: false, passwordChangedAt: new Date('2024-01-01'), password: 'hashedPassword123', birthday: new Date('1990-01-01'), dailyMessage: 'You are shiningðŸ’«!', gender: 'male', role: 'parent', avatar: '/assets/images/avatars/parent/avatar1.png', interests: ['reading', 'sports'], memberSince: new Date('2024-01-01'), currentLocation: 'not specified', stars: 100, coins: 50, nbOfTasksCompleted: 5, rankInFamily: 1, familyId: '507f1f77bcf86cd799439012', 
        // Arrays based on your schema
        adventures: [], achievements: [], purchasedItems: [], notifications: [], notes: [], goals: [], books: [], drawings: [], colorings: [], personalStories: [], 
        // Mock Mongoose methods
        save: jest.fn().mockResolvedValue(true), toJSON: jest.fn(), equals: jest.fn((id) => id === '507f1f77bcf86cd799439011') }, overrides)),
    // Create mock family based on your Family model
    createMockFamily: (overrides = {}) => (Object.assign({ _id: '507f1f77bcf86cd799439012', email: 'family@example.com', members: [], totalStars: 500, familyName: 'Test Family', 
        // Mock Mongoose methods
        save: jest.fn().mockResolvedValue(true) }, overrides)),
    // Create mock adventure based on your Adventure model
    createMockAdventure: (overrides = {}) => (Object.assign({ _id: '507f1f77bcf86cd799439015', title: 'Test Adventure', description: 'A test adventure', challenges: [
            {
                _id: '507f1f77bcf86cd799439016',
                title: 'Test Challenge',
                description: 'A test challenge',
                starsReward: 10,
                coinsReward: 5,
                equals: jest.fn((id) => id === '507f1f77bcf86cd799439016')
            }
        ], starsReward: 100, coinsReward: 50, difficulty: 'easy', category: 'learning' }, overrides)),
    // Valid MongoDB ObjectId for testing (24 character hex string)
    validObjectId: '507f1f77bcf86cd799439011',
    // Invalid ObjectId for testing error cases
    invalidObjectId: 'invalid-id-format',
    // Helper functions for nested schema objects
    createMockAdventureProgress: (overrides = {}) => (Object.assign({ adventureId: '507f1f77bcf86cd799439015', challenges: [], isAdventureCompleted: false, status: 'in-progress', progress: 0, starsReward: 10, coinsReward: 5 }, overrides)),
    createMockChallengeProgress: (overrides = {}) => (Object.assign({ challengeId: '507f1f77bcf86cd799439016', isCompleted: false, completedAt: undefined }, overrides)),
    createMockPurchasedItem: (overrides = {}) => (Object.assign({ itemId: '507f1f77bcf86cd799439017', purchasedAt: new Date() }, overrides)),
    createMockNote: (overrides = {}) => (Object.assign({ _id: '507f1f77bcf86cd799439018', title: 'Test Note', content: 'This is a test note content', type: 'personal', isPinned: false, createdAt: new Date(), updatedAt: new Date() }, overrides)),
    createMockNotification: (overrides = {}) => (Object.assign({ _id: '507f1f77bcf86cd799439019', title: 'Test Notification', message: 'This is a test notification', type: 'info', isRead: false, createdAt: new Date() }, overrides))
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVU0VSXFxEZXNrdG9wXFxndWFyZGlhbi1ncm92ZVxcZ3VhcmRpYW4tZ3JvdmUtYmFja2VuZFxcdGVzdHNcXHNldHVwLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLCtDQUErQztBQUMvQyxtQ0FBZ0M7QUFFaEMsaURBQWlEO0FBQ2pELElBQUEsZUFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUM7QUFFOUIsd0RBQXdEO0FBQ3hELElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7QUFFdkIsaUNBQWlDO0FBQ2pDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDWCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxrREFBa0Q7QUFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO0FBRTlCLGdFQUFnRTtBQUNoRSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUMxQixPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBRywwQkFBMEIsQ0FBQztBQUN4RCxDQUFDO0FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsd0JBQXdCLENBQUM7QUFDMUQsQ0FBQztBQUNELElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLGVBQWUsQ0FBQztBQUNqRCxDQUFDO0FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsK0NBQStDLENBQUM7QUFDNUUsQ0FBQztBQUNELElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFD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b3BcXGd1YXJkaWFuLWdyb3ZlXFxndWFyZGlhbi1ncm92ZS1iYWNrZW5kXFx0ZXN0c1xcc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gR2xvYmFsIHRlc3Qgc2V0dXAgZm9yIEd1YXJkaWFuIEdyb3ZlIHByb2plY3RcclxuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnZG90ZW52JztcclxuXHJcbi8vIExvYWQgdGVzdCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZnJvbSAuZW52LnRlc3RcclxuY29uZmlnKHsgcGF0aDogJy5lbnYudGVzdCcgfSk7XHJcblxyXG4vLyBTZXQgdGVzdCB0aW1lb3V0ICgxMCBzZWNvbmRzIGZvciBkYXRhYmFzZSBvcGVyYXRpb25zKVxyXG5qZXN0LnNldFRpbWVvdXQoMTAwMDApO1xyXG5cclxuLy8gR2xvYmFsIGNsZWFudXAgYWZ0ZXIgZWFjaCB0ZXN0XHJcbmFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxufSk7XHJcblxyXG4vLyBTZXQgcmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciB5b3VyIGFwcFxyXG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcclxuXHJcbi8vIEVuc3VyZSB0aGVzZSBhcmUgc2V0IGV2ZW4gaWYgLmVudi50ZXN0IGlzIG1pc3Npbmcgc29tZSB2YWx1ZXNcclxuaWYgKCFwcm9jZXNzLmVudi5KV1RfU0VDUkVUKSB7XHJcbiAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldC1mYWxsYmFjayc7XHJcbn1cclxuaWYgKCFwcm9jZXNzLmVudi5FTUFJTF9VU0VSTkFNRSkge1xyXG4gICAgcHJvY2Vzcy5lbnYuRU1BSUxfVVNFUk5BTUUgPSAndGVzdEBndWFyZGlhbmdyb3ZlLmNvbSc7XHJcbn1cclxuaWYgKCFwcm9jZXNzLmVudi5FTUFJTF9QQVNTV09SRCkge1xyXG4gICAgcHJvY2Vzcy5lbnYuRU1BSUxfUEFTU1dPUkQgPSAndGVzdC1wYXNzd29yZCc7XHJcbn1cclxuaWYgKCFwcm9jZXNzLmVudi5NT05HT19VUkkpIHtcclxuICAgIHByb2Nlc3MuZW52Lk1PTkdPX1VSSSA9ICdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3L2d1YXJkaWFuX2dyb3ZlX3Rlc3QnO1xyXG59XHJcbmlmICghcHJvY2Vzcy5lbnYuUE9SVCkge1xyXG4gICAgcHJvY2Vzcy5lbnYuUE9SVCA9ICczMDAxJztcclxufVxyXG5cclxuLy8gRXhwb3J0IHRlc3QgdXRpbGl0aWVzXHJcbmV4cG9ydCBjb25zdCB0ZXN0VXRpbHMgPSB7XHJcbiAgICAvLyBDcmVhdGUgbW9jayBFeHByZXNzIHJlcXVlc3Qgb2JqZWN0XHJcbiAgICBjcmVhdGVNb2NrUmVxdWVzdDogKG92ZXJyaWRlcyA9IHt9KSA9PiAoe1xyXG4gICAgICAgIGJvZHk6IHt9LFxyXG4gICAgICAgIHBhcmFtczoge30sXHJcbiAgICAgICAgcXVlcnk6IHt9LFxyXG4gICAgICAgIGhlYWRlcnM6IHt9LFxyXG4gICAgICAgIHVzZXI6IG51bGwsXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzLFxyXG4gICAgfSksXHJcbiAgICBcclxuICAgIC8vIENyZWF0ZSBtb2NrIEV4cHJlc3MgcmVzcG9uc2Ugb2JqZWN0IHdpdGggYWxsIG1ldGhvZHMgeW91ciBjb250cm9sbGVycyB1c2VcclxuICAgIGNyZWF0ZU1vY2tSZXNwb25zZTogKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlczogYW55ID0ge307XHJcbiAgICAgICAgcmVzLnN0YXR1cyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICAgICAgICByZXMuanNvbiA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICAgICAgICByZXMuc2VuZCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICAgICAgICByZXMuY29va2llID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShyZXMpO1xyXG4gICAgICAgIHJlcy5jbGVhckNvb2tpZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICAgICAgICByZXMucmVkaXJlY3QgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgIH0sXHJcblxyXG4gICAgLy8gQ3JlYXRlIG1vY2sgdXNlciBiYXNlZCBvbiB5b3VyIGFjdHVhbCBVc2VyIG1vZGVsIHN0cnVjdHVyZVxyXG4gICAgY3JlYXRlTW9ja1VzZXI6IChvdmVycmlkZXMgPSB7fSkgPT4gKHtcclxuICAgICAgICBfaWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxyXG4gICAgICAgIG5hbWU6ICdUZXN0IFVzZXInLFxyXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgaXNUZW1wUGFzc3dvcmQ6IGZhbHNlLFxyXG4gICAgICAgIHBhc3N3b3JkQ2hhbmdlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxyXG4gICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkUGFzc3dvcmQxMjMnLFxyXG4gICAgICAgIGJpcnRoZGF5OiBuZXcgRGF0ZSgnMTk5MC0wMS0wMScpLFxyXG4gICAgICAgIGRhaWx5TWVzc2FnZTogJ1lvdSBhcmUgc2hpbmluZ/CfkqshJyxcclxuICAgICAgICBnZW5kZXI6ICdtYWxlJyxcclxuICAgICAgICByb2xlOiAncGFyZW50JyxcclxuICAgICAgICBhdmF0YXI6ICcvYXNzZXRzL2ltYWdlcy9hdmF0YXJzL3BhcmVudC9hdmF0YXIxLnBuZycsXHJcbiAgICAgICAgaW50ZXJlc3RzOiBbJ3JlYWRpbmcnLCAnc3BvcnRzJ10sXHJcbiAgICAgICAgbWVtYmVyU2luY2U6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXHJcbiAgICAgICAgY3VycmVudExvY2F0aW9uOiAnbm90IHNwZWNpZmllZCcsXHJcbiAgICAgICAgc3RhcnM6IDEwMCxcclxuICAgICAgICBjb2luczogNTAsXHJcbiAgICAgICAgbmJPZlRhc2tzQ29tcGxldGVkOiA1LFxyXG4gICAgICAgIHJhbmtJbkZhbWlseTogMSxcclxuICAgICAgICBmYW1pbHlJZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicsXHJcbiAgICAgICAgLy8gQXJyYXlzIGJhc2VkIG9uIHlvdXIgc2NoZW1hXHJcbiAgICAgICAgYWR2ZW50dXJlczogW10sXHJcbiAgICAgICAgYWNoaWV2ZW1lbnRzOiBbXSxcclxuICAgICAgICBwdXJjaGFzZWRJdGVtczogW10sXHJcbiAgICAgICAgbm90aWZpY2F0aW9uczogW10sXHJcbiAgICAgICAgbm90ZXM6IFtdLFxyXG4gICAgICAgIGdvYWxzOiBbXSxcclxuICAgICAgICBib29rczogW10sXHJcbiAgICAgICAgZHJhd2luZ3M6IFtdLFxyXG4gICAgICAgIGNvbG9yaW5nczogW10sXHJcbiAgICAgICAgcGVyc29uYWxTdG9yaWVzOiBbXSxcclxuICAgICAgICAvLyBNb2NrIE1vbmdvb3NlIG1ldGhvZHNcclxuICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXHJcbiAgICAgICAgdG9KU09OOiBqZXN0LmZuKCksXHJcbiAgICAgICAgZXF1YWxzOiBqZXN0LmZuKChpZDogYW55KSA9PiBpZCA9PT0gJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpLFxyXG4gICAgICAgIC4uLm92ZXJyaWRlc1xyXG4gICAgfSksXHJcblxyXG4gICAgLy8gQ3JlYXRlIG1vY2sgZmFtaWx5IGJhc2VkIG9uIHlvdXIgRmFtaWx5IG1vZGVsXHJcbiAgICBjcmVhdGVNb2NrRmFtaWx5OiAob3ZlcnJpZGVzID0ge30pID0+ICh7XHJcbiAgICAgICAgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJyxcclxuICAgICAgICBlbWFpbDogJ2ZhbWlseUBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgbWVtYmVyczogW10sXHJcbiAgICAgICAgdG90YWxTdGFyczogNTAwLFxyXG4gICAgICAgIGZhbWlseU5hbWU6ICdUZXN0IEZhbWlseScsXHJcbiAgICAgICAgLy8gTW9jayBNb25nb29zZSBtZXRob2RzXHJcbiAgICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxyXG4gICAgICAgIC4uLm92ZXJyaWRlc1xyXG4gICAgfSksXHJcblxyXG4gICAgLy8gQ3JlYXRlIG1vY2sgYWR2ZW50dXJlIGJhc2VkIG9uIHlvdXIgQWR2ZW50dXJlIG1vZGVsXHJcbiAgICBjcmVhdGVNb2NrQWR2ZW50dXJlOiAob3ZlcnJpZGVzID0ge30pID0+ICh7XHJcbiAgICAgICAgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDE1JyxcclxuICAgICAgICB0aXRsZTogJ1Rlc3QgQWR2ZW50dXJlJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgdGVzdCBhZHZlbnR1cmUnLFxyXG4gICAgICAgIGNoYWxsZW5nZXM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9pZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxNicsXHJcbiAgICAgICAgICAgIHRpdGxlOiAnVGVzdCBDaGFsbGVuZ2UnLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0EgdGVzdCBjaGFsbGVuZ2UnLFxyXG4gICAgICAgICAgICBzdGFyc1Jld2FyZDogMTAsXHJcbiAgICAgICAgICAgIGNvaW5zUmV3YXJkOiA1LFxyXG4gICAgICAgICAgICBlcXVhbHM6IGplc3QuZm4oKGlkOiBhbnkpID0+IGlkID09PSAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDE2JylcclxuICAgICAgICB9XHJcbiAgICAgICAgXSxcclxuICAgICAgICBzdGFyc1Jld2FyZDogMTAwLFxyXG4gICAgICAgIGNvaW5zUmV3YXJkOiA1MCxcclxuICAgICAgICBkaWZmaWN1bHR5OiAnZWFzeScsXHJcbiAgICAgICAgY2F0ZWdvcnk6ICdsZWFybmluZycsXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzXHJcbiAgICB9KSxcclxuXHJcbiAgICAvLyBWYWxpZCBNb25nb0RCIE9iamVjdElkIGZvciB0ZXN0aW5nICgyNCBjaGFyYWN0ZXIgaGV4IHN0cmluZylcclxuICAgIHZhbGlkT2JqZWN0SWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxyXG4gICAgXHJcbiAgICAvLyBJbnZhbGlkIE9iamVjdElkIGZvciB0ZXN0aW5nIGVycm9yIGNhc2VzXHJcbiAgICBpbnZhbGlkT2JqZWN0SWQ6ICdpbnZhbGlkLWlkLWZvcm1hdCcsXHJcblxyXG4gICAgLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgbmVzdGVkIHNjaGVtYSBvYmplY3RzXHJcbiAgICBjcmVhdGVNb2NrQWR2ZW50dXJlUHJvZ3Jlc3M6IChvdmVycmlkZXMgPSB7fSkgPT4gKHtcclxuICAgICAgICBhZHZlbnR1cmVJZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxNScsXHJcbiAgICAgICAgY2hhbGxlbmdlczogW10sXHJcbiAgICAgICAgaXNBZHZlbnR1cmVDb21wbGV0ZWQ6IGZhbHNlLFxyXG4gICAgICAgIHN0YXR1czogJ2luLXByb2dyZXNzJyxcclxuICAgICAgICBwcm9ncmVzczogMCxcclxuICAgICAgICBzdGFyc1Jld2FyZDogMTAsXHJcbiAgICAgICAgY29pbnNSZXdhcmQ6IDUsXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzXHJcbiAgICB9KSxcclxuXHJcbiAgICBjcmVhdGVNb2NrQ2hhbGxlbmdlUHJvZ3Jlc3M6IChvdmVycmlkZXMgPSB7fSkgPT4gKHtcclxuICAgICAgICBjaGFsbGVuZ2VJZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxNicsXHJcbiAgICAgICAgaXNDb21wbGV0ZWQ6IGZhbHNlLFxyXG4gICAgICAgIGNvbXBsZXRlZEF0OiB1bmRlZmluZWQsXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzXHJcbiAgICB9KSxcclxuXHJcbiAgICBjcmVhdGVNb2NrUHVyY2hhc2VkSXRlbTogKG92ZXJyaWRlcyA9IHt9KSA9PiAoe1xyXG4gICAgICAgIGl0ZW1JZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxNycsXHJcbiAgICAgICAgcHVyY2hhc2VkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzXHJcbiAgICB9KSxcclxuXHJcbiAgICBjcmVhdGVNb2NrTm90ZTogKG92ZXJyaWRlcyA9IHt9KSA9PiAoe1xyXG4gICAgICAgIF9pZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxOCcsXHJcbiAgICAgICAgdGl0bGU6ICdUZXN0IE5vdGUnLFxyXG4gICAgICAgIGNvbnRlbnQ6ICdUaGlzIGlzIGEgdGVzdCBub3RlIGNvbnRlbnQnLFxyXG4gICAgICAgIHR5cGU6ICdwZXJzb25hbCcsXHJcbiAgICAgICAgaXNQaW5uZWQ6IGZhbHNlLFxyXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzXHJcbiAgICB9KSxcclxuXHJcbiAgICBjcmVhdGVNb2NrTm90aWZpY2F0aW9uOiAob3ZlcnJpZGVzID0ge30pID0+ICh7XHJcbiAgICAgICAgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDE5JyxcclxuICAgICAgICB0aXRsZTogJ1Rlc3QgTm90aWZpY2F0aW9uJyxcclxuICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhIHRlc3Qgbm90aWZpY2F0aW9uJyxcclxuICAgICAgICB0eXBlOiAnaW5mbycsXHJcbiAgICAgICAgaXNSZWFkOiBmYWxzZSxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgLi4ub3ZlcnJpZGVzXHJcbiAgICB9KVxyXG59OyJdLCJ2ZXJzaW9uIjozfQ==