d9da0e565119aa2844c416a75d5f8658
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock all dependencies
jest.mock('../../src/models/user.model');
jest.mock('../../src/models/family.model');
jest.mock('../../src/services/email.service');
jest.mock('../../src/utils/generateSecurePassword');
jest.mock('bcrypt');
jest.mock('jsonwebtoken');
const setup_1 = require("../setup");
const auth_controller_1 = require("../../src/controllers/auth.controller");
const user_model_1 = require("../../src/models/user.model");
const family_model_1 = require("../../src/models/family.model");
const generateSecurePassword = __importStar(require("../../src/utils/generateSecurePassword"));
const emailService = __importStar(require("../../src/services/email.service"));
const bcrypt = __importStar(require("bcrypt"));
const jsonwebtoken_1 = __importDefault(require("jsonwebtoken"));
const mockUser = user_model_1.User;
const mockFamily = family_model_1.Family;
const mockGenerateSecurePassword = generateSecurePassword;
const mockEmailService = emailService;
const mockBcrypt = bcrypt;
const mockJwt = jsonwebtoken_1.default;
describe('Auth Controller Tests', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        // Setup User model methods
        mockUser.findOne = jest.fn();
        mockUser.create = jest.fn();
        // Setup Family model methods
        mockFamily.findOne = jest.fn();
        // Setup utility mocks
        mockGenerateSecurePassword.generateSecurePassword.mockReturnValue('TempPass123!');
        jest.spyOn(mockEmailService, 'sendMail').mockResolvedValue(undefined);
        jest.spyOn(bcrypt, 'hash').mockResolvedValue('hashedPassword');
        jest.spyOn(bcrypt, 'compare').mockResolvedValue(true);
        jest.spyOn(jsonwebtoken_1.default, 'sign').mockResolvedValue('mock-jwt-token');
        // Set JWT_SECRET environment variable
        process.env.JWT_SECRET = 'test_jwt_secret_key_for_guardian_grove_123';
    });
    afterEach(() => {
        // Clean up environment variables if needed
        if (!process.env.JWT_SECRET) {
            process.env.JWT_SECRET = 'test_jwt_secret_key_for_guardian_grove_123';
        }
    });
    // 1. test login API
    describe('login', () => {
        const validLoginData = {
            name: 'Test User',
            email: 'test@example.com',
            password: 'TestPass123!'
        };
        it('should login successfully with valid credentials', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = Object.assign(Object.assign({}, setup_1.testUtils.createMockUser(Object.assign(Object.assign({}, validLoginData), { isTempPassword: false }))), { id: '507f1f77bcf86cd799439011' });
            mockUser.findOne.mockResolvedValue(mockUserData);
            mockBcrypt.compare.mockResolvedValue(true);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validLoginData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockUser.findOne).toHaveBeenCalledWith({
                name: validLoginData.name,
                email: validLoginData.email
            });
            expect(mockBcrypt.compare).toHaveBeenCalledWith(validLoginData.password, mockUserData.password);
            expect(mockJwt.sign).toHaveBeenCalledWith({ userId: mockUserData.id, role: mockUserData.role }, 'test_jwt_secret_key_for_guardian_grove_123');
            expect(mockRes.status).toHaveBeenCalledWith(200);
            expect(mockRes.json).toHaveBeenCalledWith({
                user: mockUserData,
                token: 'mock-jwt-token',
                requiresPasswordChange: false,
                message: 'Login successful'
            });
        }));
        it('should login with temporary password and require password change', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = Object.assign(Object.assign({}, setup_1.testUtils.createMockUser(Object.assign(Object.assign({}, validLoginData), { isTempPassword: true }))), { id: '507f1f77bcf86cd799439011' // Add id property for JWT
             });
            mockUser.findOne.mockResolvedValue(mockUserData);
            mockBcrypt.compare.mockResolvedValue(true);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validLoginData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(200);
            expect(mockRes.json).toHaveBeenCalledWith({
                user: mockUserData,
                token: 'mock-jwt-token',
                requiresPasswordChange: true,
                message: 'Please set a new password'
            });
        }));
        it('should return 400 if required fields are missing', () => __awaiter(void 0, void 0, void 0, function* () {
            const incompleteData = { name: 'Test User', email: 'test@example.com' }; // Missing password
            const mockReq = setup_1.testUtils.createMockRequest({ body: incompleteData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Name, email, and password are required.'
            });
        }));
        it('should return 404 if user not found', () => __awaiter(void 0, void 0, void 0, function* () {
            mockUser.findOne.mockResolvedValue(null);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validLoginData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(404);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Invalid credentials. User not found.'
            });
        }));
        it('should return 401 if password is incorrect', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = Object.assign(Object.assign({}, setup_1.testUtils.createMockUser(validLoginData)), { id: '507f1f77bcf86cd799439011' });
            mockUser.findOne.mockResolvedValue(mockUserData);
            mockBcrypt.compare.mockResolvedValue(false);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validLoginData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(401);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Invalid password.'
            });
        }));
        it('should handle JWT signing errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = Object.assign(Object.assign({}, setup_1.testUtils.createMockUser(validLoginData)), { id: '507f1f77bcf86cd799439011' });
            mockUser.findOne.mockResolvedValue(mockUserData);
            mockBcrypt.compare.mockResolvedValue(true);
            // Mock JWT sign to throw an error
            mockJwt.sign.mockRejectedValue(new Error('JWT signing failed'));
            const mockReq = setup_1.testUtils.createMockRequest({ body: validLoginData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Something went wrong while logging in.'
            });
        }));
        it('should handle database errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
            mockUser.findOne.mockRejectedValue(new Error('Database connection failed'));
            const mockReq = setup_1.testUtils.createMockRequest({ body: validLoginData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.login)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Something went wrong while logging in.'
            });
        }));
    });
    // 2. test register API
    describe('register', () => {
        const validRegisterData = {
            name: 'Test Parent',
            email: 'parent@example.com',
            password: 'TestPass123!',
            confirmPassword: 'TestPass123!',
            birthday: '1985-01-01',
            gender: 'male',
            role: 'parent',
            avatar: '/avatar.png',
            interests: ['reading', 'sports'],
            familyName: 'Test Family',
            familyAvatar: '/family-avatar.png'
        };
        it('should register successfully with valid data', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockFamilyData = setup_1.testUtils.createMockFamily({
                email: validRegisterData.email,
                familyName: validRegisterData.familyName,
                members: []
            });
            const mockCreatedUser = Object.assign(Object.assign({}, setup_1.testUtils.createMockUser(Object.assign(Object.assign({}, validRegisterData), { familyId: mockFamilyData._id }))), { id: '507f1f77bcf86cd799439011' // Add id property for JWT
             });
            mockFamily.findOne.mockResolvedValue(null); // New family
            mockFamily.prototype.save = jest.fn().mockResolvedValue(mockFamilyData);
            mockUser.findOne.mockResolvedValue(null); // No existing user with same name
            mockUser.create.mockResolvedValue(mockCreatedUser);
            // Mock the Family constructor
            mockFamily.mockImplementation(() => (Object.assign(Object.assign({}, mockFamilyData), { save: jest.fn().mockResolvedValue(mockFamilyData) })));
            const mockReq = setup_1.testUtils.createMockRequest({ body: validRegisterData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockBcrypt.hash).toHaveBeenCalledWith(validRegisterData.password, 12);
            expect(mockUser.create).toHaveBeenCalled();
            expect(mockJwt.sign).toHaveBeenCalledWith({ userId: mockCreatedUser.id, role: mockCreatedUser.role }, 'test_jwt_secret_key_for_guardian_grove_123');
            expect(mockRes.status).toHaveBeenCalledWith(200);
        }));
        it('should register with existing family', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockFamilyData = setup_1.testUtils.createMockFamily({
                email: validRegisterData.email,
                familyName: validRegisterData.familyName,
                members: []
            });
            mockFamilyData.save = jest.fn().mockResolvedValue(mockFamilyData);
            const mockCreatedUser = Object.assign(Object.assign({}, setup_1.testUtils.createMockUser(Object.assign(Object.assign({}, validRegisterData), { familyId: mockFamilyData._id }))), { id: '507f1f77bcf86cd799439011' // Add id property for JWT
             });
            mockFamily.findOne.mockResolvedValue(mockFamilyData);
            mockUser.findOne.mockResolvedValue(null);
            mockUser.create.mockResolvedValue(mockCreatedUser);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validRegisterData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(200);
        }));
        it('should return 400 if required fields are missing', () => __awaiter(void 0, void 0, void 0, function* () {
            const incompleteData = Object.assign({}, validRegisterData);
            delete incompleteData.name;
            const mockReq = setup_1.testUtils.createMockRequest({ body: incompleteData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'All required fields must be filled.'
            });
        }));
        it('should return 400 if passwords do not match', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { confirmPassword: 'DifferentPass123!' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Passwords do not match'
            });
        }));
        it('should return 400 if email format is invalid', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { email: 'invalid-email' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Invalid email format.'
            });
        }));
        it('should return 400 if role is child', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { role: 'child' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Children must be added by a parent.'
            });
        }));
        it('should return 400 if role is invalid', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { role: 'invalid-role' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Invalid role.'
            });
        }));
        it('should return 400 if interests is not an array', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { interests: 'not-an-array' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Interests must be an array.'
            });
        }));
        it('should return 400 if gender is invalid', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { gender: 'invalid-gender' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: "Gender must be either 'male' or 'female'."
            });
        }));
        it('should return 400 if birthday format is invalid', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { birthday: 'invalid-date' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Invalid birthday format.'
            });
        }));
        it('should return 400 if password does not meet requirements', () => __awaiter(void 0, void 0, void 0, function* () {
            const invalidData = Object.assign(Object.assign({}, validRegisterData), { password: 'weak', confirmPassword: 'weak' });
            const mockReq = setup_1.testUtils.createMockRequest({ body: invalidData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Password must be at least 8 characters long, include an uppercase letter, lowercase letter, a number, and a special character.'
            });
        }));
        it('should return 400 if family name is wrong for existing family', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockFamilyData = setup_1.testUtils.createMockFamily({
                email: validRegisterData.email,
                familyName: 'Different Family Name'
            });
            mockFamily.findOne.mockResolvedValue(mockFamilyData);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validRegisterData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Wrong family name'
            });
        }));
        it('should return 400 if member with same name exists in family', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockFamilyData = setup_1.testUtils.createMockFamily({
                email: validRegisterData.email,
                familyName: validRegisterData.familyName
            });
            const existingUser = setup_1.testUtils.createMockUser({
                name: validRegisterData.name,
                familyId: mockFamilyData._id
            });
            mockFamily.findOne.mockResolvedValue(mockFamilyData);
            mockUser.findOne.mockResolvedValue(existingUser);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validRegisterData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'A member with this name already exists in the family.'
            });
        }));
        it('should handle database errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
            mockFamily.findOne.mockRejectedValue(new Error('Database connection failed'));
            const mockReq = setup_1.testUtils.createMockRequest({ body: validRegisterData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.register)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Something went wrong while registering.'
            });
        }));
    });
    // 3. test forgetPassword API
    describe('forgetPassword', () => {
        const validForgetPasswordData = {
            name: 'Test User',
            email: 'test@example.com'
        };
        it('should send temporary password successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = setup_1.testUtils.createMockUser(validForgetPasswordData);
            mockUser.findOne.mockResolvedValue(mockUserData);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockUser.findOne).toHaveBeenCalledWith({
                email: validForgetPasswordData.email,
                name: validForgetPasswordData.name
            });
            expect(mockGenerateSecurePassword.generateSecurePassword).toHaveBeenCalled();
            expect(mockBcrypt.hash).toHaveBeenCalledWith('TempPass123!', 12);
            expect(mockUserData.isTempPassword).toBe(true);
            expect(mockUserData.passwordChangedAt).toBeDefined();
            expect(mockEmailService.sendMail).toHaveBeenCalledWith(expect.stringContaining('Guardian Grove'), validForgetPasswordData.email, 'Your Temporary Password', expect.stringContaining('TempPass123!'));
            expect(mockRes.status).toHaveBeenCalledWith(200);
            expect(mockRes.send).toHaveBeenCalledWith({
                message: 'Temporary password sent to your email.'
            });
        }));
        it('should return 404 if user not found', () => __awaiter(void 0, void 0, void 0, function* () {
            mockUser.findOne.mockResolvedValue(null);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(404);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Invalid credentials. User not found.'
            });
        }));
        it('should handle email service errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = setup_1.testUtils.createMockUser(validForgetPasswordData);
            mockUser.findOne.mockResolvedValue(mockUserData);
            mockEmailService.sendMail.mockRejectedValue(new Error('Email service failed'));
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Error sending temporary password.'
            });
        }));
        it('should handle database save errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = setup_1.testUtils.createMockUser(validForgetPasswordData);
            mockUserData.save = jest.fn().mockRejectedValue(new Error('Database save failed'));
            mockUser.findOne.mockResolvedValue(mockUserData);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Error sending temporary password.'
            });
        }));
        it('should handle password hashing errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = setup_1.testUtils.createMockUser(validForgetPasswordData);
            mockUser.findOne.mockResolvedValue(mockUserData);
            mockBcrypt.hash.mockRejectedValue(new Error('Hashing failed'));
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalledWith({
                error: 'Error sending temporary password.'
            });
        }));
        it('should generate proper email HTML content', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = setup_1.testUtils.createMockUser(Object.assign(Object.assign({}, validForgetPasswordData), { name: 'John Doe' }));
            mockUser.findOne.mockResolvedValue(mockUserData);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockEmailService.sendMail).toHaveBeenCalledWith(expect.any(String), validForgetPasswordData.email, 'Your Temporary Password', expect.stringMatching(/Hello John Doe/));
            expect(mockEmailService.sendMail).toHaveBeenCalledWith(expect.any(String), validForgetPasswordData.email, 'Your Temporary Password', expect.stringMatching(/TempPass123!/));
            expect(mockEmailService.sendMail).toHaveBeenCalledWith(expect.any(String), validForgetPasswordData.email, 'Your Temporary Password', expect.stringMatching(/Guardian Grove Team/));
        }));
        it('should set correct user properties after password reset', () => __awaiter(void 0, void 0, void 0, function* () {
            const mockUserData = setup_1.testUtils.createMockUser(Object.assign(Object.assign({}, validForgetPasswordData), { isTempPassword: false, passwordChangedAt: new Date('2024-01-01') }));
            mockUser.findOne.mockResolvedValue(mockUserData);
            const mockReq = setup_1.testUtils.createMockRequest({ body: validForgetPasswordData });
            const mockRes = setup_1.testUtils.createMockResponse();
            yield (0, auth_controller_1.forgetPassword)(mockReq, mockRes);
            expect(mockUserData.password).toBe('hashedPassword');
            expect(mockUserData.isTempPassword).toBe(true);
            expect(mockUserData.passwordChangedAt).toBeInstanceOf(Date);
            expect(mockUserData.save).toHaveBeenCalled();
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVU0VSXFxEZXNrdG9wXFxndWFyZGlhbi1ncm92ZVxcZ3VhcmRpYW4tZ3JvdmUtYmFja2VuZFxcdGVzdHNcXGNvbnRyb2xsZXJzXFxhdXRoLmNvbnRyb2xsZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVNBLHdCQUF3QjtBQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLENBQUM7QUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztBQUM5QyxJQUFJLENBQUMsSUFBSSxDQUFDLHdDQUF3QyxDQUFDLENBQUM7QUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBZjFCLG9DQUFxQztBQUNyQywyRUFBd0Y7QUFDeEYsNERBQW1EO0FBQ25ELGdFQUF1RDtBQUN2RCwrRkFBaUY7QUFDakYsK0VBQWlFO0FBQ2pFLCtDQUFpQztBQUNqQyxnRUFBK0I7QUFVL0IsTUFBTSxRQUFRLEdBQUcsaUJBQWdDLENBQUM7QUFDbEQsTUFBTSxVQUFVLEdBQUcscUJBQW9DLENBQUM7QUFDeEQsTUFBTSwwQkFBMEIsR0FBRyxzQkFBb0UsQ0FBQztBQUN4RyxNQUFNLGdCQUFnQixHQUFHLFlBQWdELENBQUM7QUFDMUUsTUFBTSxVQUFVLEdBQUcsTUFBb0MsQ0FBQztBQUN4RCxNQUFNLE9BQU8sR0FBRyxzQkFBOEIsQ0FBQztBQUUvQyxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsMkJBQTJCO1FBQzNCLFFBQVEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFB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LElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDakQsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVU0VSXFxEZXNrdG9wXFxndWFyZGlhbi1ncm92ZVxcZ3VhcmRpYW4tZ3JvdmUtYmFja2VuZFxcdGVzdHNcXGNvbnRyb2xsZXJzXFxhdXRoLmNvbnRyb2xsZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZXN0VXRpbHMgfSBmcm9tICcuLi9zZXR1cCc7XHJcbmltcG9ydCB7IGxvZ2luLCByZWdpc3RlciwgZm9yZ2V0UGFzc3dvcmQgfSBmcm9tICcuLi8uLi9zcmMvY29udHJvbGxlcnMvYXV0aC5jb250cm9sbGVyJztcclxuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uLy4uL3NyYy9tb2RlbHMvdXNlci5tb2RlbCc7XHJcbmltcG9ydCB7IEZhbWlseSB9IGZyb20gJy4uLy4uL3NyYy9tb2RlbHMvZmFtaWx5Lm1vZGVsJztcclxuaW1wb3J0ICogYXMgZ2VuZXJhdGVTZWN1cmVQYXNzd29yZCBmcm9tICcuLi8uLi9zcmMvdXRpbHMvZ2VuZXJhdGVTZWN1cmVQYXNzd29yZCc7XHJcbmltcG9ydCAqIGFzIGVtYWlsU2VydmljZSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvZW1haWwuc2VydmljZSc7XHJcbmltcG9ydCAqIGFzIGJjcnlwdCBmcm9tICdiY3J5cHQnO1xyXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XHJcblxyXG4vLyBNb2NrIGFsbCBkZXBlbmRlbmNpZXNcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvbW9kZWxzL3VzZXIubW9kZWwnKTtcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvbW9kZWxzL2ZhbWlseS5tb2RlbCcpO1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9zZXJ2aWNlcy9lbWFpbC5zZXJ2aWNlJyk7XHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3V0aWxzL2dlbmVyYXRlU2VjdXJlUGFzc3dvcmQnKTtcclxuamVzdC5tb2NrKCdiY3J5cHQnKTtcclxuamVzdC5tb2NrKCdqc29ud2VidG9rZW4nKTtcclxuXHJcbmNvbnN0IG1vY2tVc2VyID0gVXNlciBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgVXNlcj47XHJcbmNvbnN0IG1vY2tGYW1pbHkgPSBGYW1pbHkgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIEZhbWlseT47XHJcbmNvbnN0IG1vY2tHZW5lcmF0ZVNlY3VyZVBhc3N3b3JkID0gZ2VuZXJhdGVTZWN1cmVQYXNzd29yZCBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgZ2VuZXJhdGVTZWN1cmVQYXNzd29yZD47XHJcbmNvbnN0IG1vY2tFbWFpbFNlcnZpY2UgPSBlbWFpbFNlcnZpY2UgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGVtYWlsU2VydmljZT47XHJcbmNvbnN0IG1vY2tCY3J5cHQgPSBiY3J5cHQgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGJjcnlwdD47XHJcbmNvbnN0IG1vY2tKd3QgPSBqd3QgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGp3dD47XHJcblxyXG5kZXNjcmliZSgnQXV0aCBDb250cm9sbGVyIFRlc3RzJywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0dXAgVXNlciBtb2RlbCBtZXRob2RzXHJcbiAgICAgICAgbW9ja1VzZXIuZmluZE9uZSA9IGplc3QuZm4oKTtcclxuICAgICAgICBtb2NrVXNlci5jcmVhdGUgPSBqZXN0LmZuKCk7XHJcblxyXG4gICAgICAgIC8vIFNldHVwIEZhbWlseSBtb2RlbCBtZXRob2RzXHJcbiAgICAgICAgbW9ja0ZhbWlseS5maW5kT25lID0gamVzdC5mbigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldHVwIHV0aWxpdHkgbW9ja3NcclxuICAgICAgICBtb2NrR2VuZXJhdGVTZWN1cmVQYXNzd29yZC5nZW5lcmF0ZVNlY3VyZVBhc3N3b3JkLm1vY2tSZXR1cm5WYWx1ZSgnVGVtcFBhc3MxMjMhJyk7XHJcbiAgICAgICAgamVzdC5zcHlPbihtb2NrRW1haWxTZXJ2aWNlLCAnc2VuZE1haWwnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIChqZXN0LnNweU9uKGJjcnlwdCwgJ2hhc2gnKSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKCdoYXNoZWRQYXNzd29yZCcpO1xyXG4gICAgICAgIChqZXN0LnNweU9uKGJjcnlwdCwgJ2NvbXBhcmUnKSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG4gICAgICAgIChqZXN0LnNweU9uKGp3dCwgJ3NpZ24nKSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKCdtb2NrLWp3dC10b2tlbicpO1xyXG5cclxuICAgICAgICAvLyBTZXQgSldUX1NFQ1JFVCBlbnZpcm9ubWVudCB2YXJpYWJsZVxyXG4gICAgICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPSAndGVzdF9qd3Rfc2VjcmV0X2tleV9mb3JfZ3VhcmRpYW5fZ3JvdmVfMTIzJztcclxuICAgIH0pO1xyXG5cclxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gQ2xlYW4gdXAgZW52aXJvbm1lbnQgdmFyaWFibGVzIGlmIG5lZWRlZFxyXG4gICAgICAgIGlmICghcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCkge1xyXG4gICAgICAgICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Rfand0X3NlY3JldF9rZXlfZm9yX2d1YXJkaWFuX2dyb3ZlXzEyMyc7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gMS4gdGVzdCBsb2dpbiBBUElcclxuICAgIGRlc2NyaWJlKCdsb2dpbicsICgpID0+IHtcclxuICAgICAgICBjb25zdCB2YWxpZExvZ2luRGF0YSA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcicsXHJcbiAgICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiAnVGVzdFBhc3MxMjMhJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbG9naW4gc3VjY2Vzc2Z1bGx5IHdpdGggdmFsaWQgY3JlZGVudGlhbHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVc2VyRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnRlc3RVdGlscy5jcmVhdGVNb2NrVXNlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udmFsaWRMb2dpbkRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNUZW1wUGFzc3dvcmQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIGlkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlckRhdGEgYXMgYW55KTtcclxuICAgICAgICAgICAgKG1vY2tCY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkTG9naW5EYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgbG9naW4obW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVXNlci5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2YWxpZExvZ2luRGF0YS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgZW1haWw6IHZhbGlkTG9naW5EYXRhLmVtYWlsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0JjcnlwdC5jb21wYXJlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh2YWxpZExvZ2luRGF0YS5wYXNzd29yZCwgbW9ja1VzZXJEYXRhLnBhc3N3b3JkKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tKd3Quc2lnbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICB7IHVzZXJJZDogbW9ja1VzZXJEYXRhLmlkLCByb2xlOiBtb2NrVXNlckRhdGEucm9sZSB9LFxyXG4gICAgICAgICAgICAgICAgJ3Rlc3Rfand0X3NlY3JldF9rZXlfZm9yX2d1YXJkaWFuX2dyb3ZlXzEyMydcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgyMDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICB1c2VyOiBtb2NrVXNlckRhdGEsXHJcbiAgICAgICAgICAgICAgICB0b2tlbjogJ21vY2stand0LXRva2VuJyxcclxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUGFzc3dvcmRDaGFuZ2U6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0xvZ2luIHN1Y2Nlc3NmdWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGxvZ2luIHdpdGggdGVtcG9yYXJ5IHBhc3N3b3JkIGFuZCByZXF1aXJlIHBhc3N3b3JkIGNoYW5nZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VzZXJEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgLi4udGVzdFV0aWxzLmNyZWF0ZU1vY2tVc2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAuLi52YWxpZExvZ2luRGF0YSxcclxuICAgICAgICAgICAgICAgICAgICBpc1RlbXBQYXNzd29yZDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBpZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScgLy8gQWRkIGlkIHByb3BlcnR5IGZvciBKV1RcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlckRhdGEgYXMgYW55KTtcclxuICAgICAgICAgICAgKG1vY2tCY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkTG9naW5EYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgbG9naW4obW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgICAgICAgICAgdXNlcjogbW9ja1VzZXJEYXRhLFxyXG4gICAgICAgICAgICAgICAgdG9rZW46ICdtb2NrLWp3dC10b2tlbicsXHJcbiAgICAgICAgICAgICAgICByZXF1aXJlc1Bhc3N3b3JkQ2hhbmdlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1BsZWFzZSBzZXQgYSBuZXcgcGFzc3dvcmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgaWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbmNvbXBsZXRlRGF0YSA9IHsgbmFtZTogJ1Rlc3QgVXNlcicsIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScgfTsgLy8gTWlzc2luZyBwYXNzd29yZFxyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IGluY29tcGxldGVEYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgbG9naW4obW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdOYW1lLCBlbWFpbCwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZC4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiA0MDQgaWYgdXNlciBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tVc2VyLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogdmFsaWRMb2dpbkRhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCBsb2dpbihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDQpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgY3JlZGVudGlhbHMuIFVzZXIgbm90IGZvdW5kLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMSBpZiBwYXNzd29yZCBpcyBpbmNvcnJlY3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVc2VyRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnRlc3RVdGlscy5jcmVhdGVNb2NrVXNlcih2YWxpZExvZ2luRGF0YSksXHJcbiAgICAgICAgICAgICAgICBpZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMSdcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlckRhdGEgYXMgYW55KTtcclxuICAgICAgICAgICAgKG1vY2tCY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiB2YWxpZExvZ2luRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IGxvZ2luKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBwYXNzd29yZC4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBKV1Qgc2lnbmluZyBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VzZXJEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgLi4udGVzdFV0aWxzLmNyZWF0ZU1vY2tVc2VyKHZhbGlkTG9naW5EYXRhKSxcclxuICAgICAgICAgICAgICAgIGlkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBtb2NrVXNlci5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyRGF0YSBhcyBhbnkpO1xyXG4gICAgICAgICAgICAobW9ja0JjcnlwdC5jb21wYXJlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcbiAgICAgICAgICAgIC8vIE1vY2sgSldUIHNpZ24gdG8gdGhyb3cgYW4gZXJyb3JcclxuICAgICAgICAgICAgKG1vY2tKd3Quc2lnbiBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSldUIHNpZ25pbmcgZmFpbGVkJykpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkTG9naW5EYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgbG9naW4obW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdTb21ldGhpbmcgd2VudCB3cm9uZyB3aGlsZSBsb2dnaW5nIGluLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrVXNlci5maW5kT25lLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogdmFsaWRMb2dpbkRhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCBsb2dpbihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg1MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ1NvbWV0aGluZyB3ZW50IHdyb25nIHdoaWxlIGxvZ2dpbmcgaW4uJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIDIuIHRlc3QgcmVnaXN0ZXIgQVBJXHJcbiAgICBkZXNjcmliZSgncmVnaXN0ZXInLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdmFsaWRSZWdpc3RlckRhdGEgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdUZXN0IFBhcmVudCcsXHJcbiAgICAgICAgICAgIGVtYWlsOiAncGFyZW50QGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICdUZXN0UGFzczEyMyEnLFxyXG4gICAgICAgICAgICBjb25maXJtUGFzc3dvcmQ6ICdUZXN0UGFzczEyMyEnLFxyXG4gICAgICAgICAgICBiaXJ0aGRheTogJzE5ODUtMDEtMDEnLFxyXG4gICAgICAgICAgICBnZW5kZXI6ICdtYWxlJyxcclxuICAgICAgICAgICAgcm9sZTogJ3BhcmVudCcsXHJcbiAgICAgICAgICAgIGF2YXRhcjogJy9hdmF0YXIucG5nJyxcclxuICAgICAgICAgICAgaW50ZXJlc3RzOiBbJ3JlYWRpbmcnLCAnc3BvcnRzJ10sXHJcbiAgICAgICAgICAgIGZhbWlseU5hbWU6ICdUZXN0IEZhbWlseScsXHJcbiAgICAgICAgICAgIGZhbWlseUF2YXRhcjogJy9mYW1pbHktYXZhdGFyLnBuZydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIHN1Y2Nlc3NmdWxseSB3aXRoIHZhbGlkIGRhdGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGYW1pbHlEYXRhID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tGYW1pbHkoe1xyXG4gICAgICAgICAgICAgICAgZW1haWw6IHZhbGlkUmVnaXN0ZXJEYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgZmFtaWx5TmFtZTogdmFsaWRSZWdpc3RlckRhdGEuZmFtaWx5TmFtZSxcclxuICAgICAgICAgICAgICAgIG1lbWJlcnM6IFtdXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrQ3JlYXRlZFVzZXIgPSB7XHJcbiAgICAgICAgICAgICAgICAuLi50ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnZhbGlkUmVnaXN0ZXJEYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIGZhbWlseUlkOiBtb2NrRmFtaWx5RGF0YS5faWRcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgaWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnIC8vIEFkZCBpZCBwcm9wZXJ0eSBmb3IgSldUXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBtb2NrRmFtaWx5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7IC8vIE5ldyBmYW1pbHlcclxuICAgICAgICAgICAgbW9ja0ZhbWlseS5wcm90b3R5cGUuc2F2ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFtaWx5RGF0YSk7XHJcbiAgICAgICAgICAgIG1vY2tVc2VyLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7IC8vIE5vIGV4aXN0aW5nIHVzZXIgd2l0aCBzYW1lIG5hbWVcclxuICAgICAgICAgICAgbW9ja1VzZXIuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVkVXNlciBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgLy8gTW9jayB0aGUgRmFtaWx5IGNvbnN0cnVjdG9yXHJcbiAgICAgICAgICAgIChtb2NrRmFtaWx5IGFzIGFueSkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgICAuLi5tb2NrRmFtaWx5RGF0YSxcclxuICAgICAgICAgICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFtaWx5RGF0YSlcclxuICAgICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkUmVnaXN0ZXJEYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgcmVnaXN0ZXIobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQmNyeXB0Lmhhc2gpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHZhbGlkUmVnaXN0ZXJEYXRhLnBhc3N3b3JkLCAxMik7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVXNlci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tKd3Quc2lnbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICB7IHVzZXJJZDogbW9ja0NyZWF0ZWRVc2VyLmlkLCByb2xlOiBtb2NrQ3JlYXRlZFVzZXIucm9sZSB9LFxyXG4gICAgICAgICAgICAgICAgJ3Rlc3Rfand0X3NlY3JldF9rZXlfZm9yX2d1YXJkaWFuX2dyb3ZlXzEyMydcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgyMDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIHdpdGggZXhpc3RpbmcgZmFtaWx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmFtaWx5RGF0YSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrRmFtaWx5KHtcclxuICAgICAgICAgICAgICAgIGVtYWlsOiB2YWxpZFJlZ2lzdGVyRGF0YS5lbWFpbCxcclxuICAgICAgICAgICAgICAgIGZhbWlseU5hbWU6IHZhbGlkUmVnaXN0ZXJEYXRhLmZhbWlseU5hbWUsXHJcbiAgICAgICAgICAgICAgICBtZW1iZXJzOiBbXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbW9ja0ZhbWlseURhdGEuc2F2ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFtaWx5RGF0YSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrQ3JlYXRlZFVzZXIgPSB7XHJcbiAgICAgICAgICAgICAgICAuLi50ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnZhbGlkUmVnaXN0ZXJEYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIGZhbWlseUlkOiBtb2NrRmFtaWx5RGF0YS5faWRcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgaWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnIC8vIEFkZCBpZCBwcm9wZXJ0eSBmb3IgSldUXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBtb2NrRmFtaWx5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ZhbWlseURhdGEgYXMgYW55KTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVkVXNlciBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkUmVnaXN0ZXJEYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgcmVnaXN0ZXIobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGlmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW5jb21wbGV0ZURhdGE6IFBhcnRpYWw8dHlwZW9mIHZhbGlkUmVnaXN0ZXJEYXRhPiA9IHsgLi4udmFsaWRSZWdpc3RlckRhdGEgfTtcclxuICAgICAgICAgICAgZGVsZXRlIGluY29tcGxldGVEYXRhLm5hbWU7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogaW5jb21wbGV0ZURhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0FsbCByZXF1aXJlZCBmaWVsZHMgbXVzdCBiZSBmaWxsZWQuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGlmIHBhc3N3b3JkcyBkbyBub3QgbWF0Y2gnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgLi4udmFsaWRSZWdpc3RlckRhdGEsXHJcbiAgICAgICAgICAgICAgICBjb25maXJtUGFzc3dvcmQ6ICdEaWZmZXJlbnRQYXNzMTIzISdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiBpbnZhbGlkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZ2lzdGVyKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnUGFzc3dvcmRzIGRvIG5vdCBtYXRjaCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMCBpZiBlbWFpbCBmb3JtYXQgaXMgaW52YWxpZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAuLi52YWxpZFJlZ2lzdGVyRGF0YSxcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAnaW52YWxpZC1lbWFpbCdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiBpbnZhbGlkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZ2lzdGVyKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGlmIHJvbGUgaXMgY2hpbGQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgLi4udmFsaWRSZWdpc3RlckRhdGEsXHJcbiAgICAgICAgICAgICAgICByb2xlOiAnY2hpbGQnXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogaW52YWxpZERhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0NoaWxkcmVuIG11c3QgYmUgYWRkZWQgYnkgYSBwYXJlbnQuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGlmIHJvbGUgaXMgaW52YWxpZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAuLi52YWxpZFJlZ2lzdGVyRGF0YSxcclxuICAgICAgICAgICAgICAgIHJvbGU6ICdpbnZhbGlkLXJvbGUnXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogaW52YWxpZERhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgcm9sZS4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgaWYgaW50ZXJlc3RzIGlzIG5vdCBhbiBhcnJheScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAuLi52YWxpZFJlZ2lzdGVyRGF0YSxcclxuICAgICAgICAgICAgICAgIGludGVyZXN0czogJ25vdC1hbi1hcnJheSdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiBpbnZhbGlkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZ2lzdGVyKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnSW50ZXJlc3RzIG11c3QgYmUgYW4gYXJyYXkuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGlmIGdlbmRlciBpcyBpbnZhbGlkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnZhbGlkUmVnaXN0ZXJEYXRhLFxyXG4gICAgICAgICAgICAgICAgZ2VuZGVyOiAnaW52YWxpZC1nZW5kZXInXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogaW52YWxpZERhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogXCJHZW5kZXIgbXVzdCBiZSBlaXRoZXIgJ21hbGUnIG9yICdmZW1hbGUnLlwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgaWYgYmlydGhkYXkgZm9ybWF0IGlzIGludmFsaWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgLi4udmFsaWRSZWdpc3RlckRhdGEsXHJcbiAgICAgICAgICAgICAgICBiaXJ0aGRheTogJ2ludmFsaWQtZGF0ZSdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiBpbnZhbGlkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZ2lzdGVyKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBiaXJ0aGRheSBmb3JtYXQuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGlmIHBhc3N3b3JkIGRvZXMgbm90IG1lZXQgcmVxdWlyZW1lbnRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnZhbGlkUmVnaXN0ZXJEYXRhLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICd3ZWFrJyxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1QYXNzd29yZDogJ3dlYWsnXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogaW52YWxpZERhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ1Bhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmcsIGluY2x1ZGUgYW4gdXBwZXJjYXNlIGxldHRlciwgbG93ZXJjYXNlIGxldHRlciwgYSBudW1iZXIsIGFuZCBhIHNwZWNpYWwgY2hhcmFjdGVyLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMCBpZiBmYW1pbHkgbmFtZSBpcyB3cm9uZyBmb3IgZXhpc3RpbmcgZmFtaWx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmFtaWx5RGF0YSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrRmFtaWx5KHtcclxuICAgICAgICAgICAgICAgIGVtYWlsOiB2YWxpZFJlZ2lzdGVyRGF0YS5lbWFpbCxcclxuICAgICAgICAgICAgICAgIGZhbWlseU5hbWU6ICdEaWZmZXJlbnQgRmFtaWx5IE5hbWUnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtb2NrRmFtaWx5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ZhbWlseURhdGEgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiB2YWxpZFJlZ2lzdGVyRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZ2lzdGVyKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnV3JvbmcgZmFtaWx5IG5hbWUnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgaWYgbWVtYmVyIHdpdGggc2FtZSBuYW1lIGV4aXN0cyBpbiBmYW1pbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGYW1pbHlEYXRhID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tGYW1pbHkoe1xyXG4gICAgICAgICAgICAgICAgZW1haWw6IHZhbGlkUmVnaXN0ZXJEYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgZmFtaWx5TmFtZTogdmFsaWRSZWdpc3RlckRhdGEuZmFtaWx5TmFtZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tVc2VyKHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IHZhbGlkUmVnaXN0ZXJEYXRhLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBmYW1pbHlJZDogbW9ja0ZhbWlseURhdGEuX2lkXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja0ZhbWlseS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tGYW1pbHlEYXRhIGFzIGFueSk7XHJcbiAgICAgICAgICAgIG1vY2tVc2VyLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoZXhpc3RpbmdVc2VyIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVxID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0KHsgYm9keTogdmFsaWRSZWdpc3RlckRhdGEgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXMgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1Jlc3BvbnNlKCk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcihtb2NrUmVxIGFzIGFueSwgbW9ja1JlcyBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0EgbWVtYmVyIHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzIGluIHRoZSBmYW1pbHkuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tGYW1pbHkuZmluZE9uZS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJykpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkUmVnaXN0ZXJEYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgcmVnaXN0ZXIobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdTb21ldGhpbmcgd2VudCB3cm9uZyB3aGlsZSByZWdpc3RlcmluZy4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgXHJcbiAgICAvLyAzLiB0ZXN0IGZvcmdldFBhc3N3b3JkIEFQSVxyXG4gICAgZGVzY3JpYmUoJ2ZvcmdldFBhc3N3b3JkJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJyxcclxuICAgICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2VuZCB0ZW1wb3JhcnkgcGFzc3dvcmQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXNlckRhdGEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIodmFsaWRGb3JnZXRQYXNzd29yZERhdGEpO1xyXG4gICAgICAgICAgICBtb2NrVXNlci5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyRGF0YSBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgZm9yZ2V0UGFzc3dvcmQobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVXNlci5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgICAgICBlbWFpbDogdmFsaWRGb3JnZXRQYXNzd29yZERhdGEuZW1haWwsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2YWxpZEZvcmdldFBhc3N3b3JkRGF0YS5uYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0dlbmVyYXRlU2VjdXJlUGFzc3dvcmQuZ2VuZXJhdGVTZWN1cmVQYXNzd29yZCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0JjcnlwdC5oYXNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVGVtcFBhc3MxMjMhJywgMTIpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VzZXJEYXRhLmlzVGVtcFBhc3N3b3JkKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VzZXJEYXRhLnBhc3N3b3JkQ2hhbmdlZEF0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0VtYWlsU2VydmljZS5zZW5kTWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnR3VhcmRpYW4gR3JvdmUnKSxcclxuICAgICAgICAgICAgICAgIHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgJ1lvdXIgVGVtcG9yYXJ5IFBhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdUZW1wUGFzczEyMyEnKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUZW1wb3JhcnkgcGFzc3dvcmQgc2VudCB0byB5b3VyIGVtYWlsLidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwNCBpZiB1c2VyIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiB2YWxpZEZvcmdldFBhc3N3b3JkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IGZvcmdldFBhc3N3b3JkKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwNCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBjcmVkZW50aWFscy4gVXNlciBub3QgZm91bmQuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1haWwgc2VydmljZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VzZXJEYXRhID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tVc2VyKHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhKTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlckRhdGEgYXMgYW55KTtcclxuICAgICAgICAgICAgbW9ja0VtYWlsU2VydmljZS5zZW5kTWFpbC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0VtYWlsIHNlcnZpY2UgZmFpbGVkJykpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgZm9yZ2V0UGFzc3dvcmQobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdFcnJvciBzZW5kaW5nIHRlbXBvcmFyeSBwYXNzd29yZC4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBzYXZlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXNlckRhdGEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIodmFsaWRGb3JnZXRQYXNzd29yZERhdGEpO1xyXG4gICAgICAgICAgICBtb2NrVXNlckRhdGEuc2F2ZSA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0RhdGFiYXNlIHNhdmUgZmFpbGVkJykpO1xyXG4gICAgICAgICAgICBtb2NrVXNlci5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyRGF0YSBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgZm9yZ2V0UGFzc3dvcmQobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tSZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdFcnJvciBzZW5kaW5nIHRlbXBvcmFyeSBwYXNzd29yZC4nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYXNzd29yZCBoYXNoaW5nIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXNlckRhdGEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIodmFsaWRGb3JnZXRQYXNzd29yZERhdGEpO1xyXG4gICAgICAgICAgICBtb2NrVXNlci5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyRGF0YSBhcyBhbnkpO1xyXG4gICAgICAgICAgICAobW9ja0JjcnlwdC5oYXNoIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdIYXNoaW5nIGZhaWxlZCcpKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiB2YWxpZEZvcmdldFBhc3N3b3JkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IGZvcmdldFBhc3N3b3JkKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1Jlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDUwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiAnRXJyb3Igc2VuZGluZyB0ZW1wb3JhcnkgcGFzc3dvcmQuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBwcm9wZXIgZW1haWwgSFRNTCBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXNlckRhdGEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIoe1xyXG4gICAgICAgICAgICAgICAgLi4udmFsaWRGb3JnZXRQYXNzd29yZERhdGEsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnSm9obiBEb2UnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtb2NrVXNlci5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyRGF0YSBhcyBhbnkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcSA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdCh7IGJvZHk6IHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrUmVzID0gdGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXNwb25zZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgZm9yZ2V0UGFzc3dvcmQobW9ja1JlcSBhcyBhbnksIG1vY2tSZXMgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrRW1haWxTZXJ2aWNlLnNlbmRNYWlsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgICAgICAgIHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgJ1lvdXIgVGVtcG9yYXJ5IFBhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdNYXRjaGluZygvSGVsbG8gSm9obiBEb2UvKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0VtYWlsU2VydmljZS5zZW5kTWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3QuYW55KFN0cmluZyksXHJcbiAgICAgICAgICAgICAgICB2YWxpZEZvcmdldFBhc3N3b3JkRGF0YS5lbWFpbCxcclxuICAgICAgICAgICAgICAgICdZb3VyIFRlbXBvcmFyeSBQYXNzd29yZCcsXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoL1RlbXBQYXNzMTIzIS8pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrRW1haWxTZXJ2aWNlLnNlbmRNYWlsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgICAgICAgIHZhbGlkRm9yZ2V0UGFzc3dvcmREYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgJ1lvdXIgVGVtcG9yYXJ5IFBhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdNYXRjaGluZygvR3VhcmRpYW4gR3JvdmUgVGVhbS8pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2V0IGNvcnJlY3QgdXNlciBwcm9wZXJ0aWVzIGFmdGVyIHBhc3N3b3JkIHJlc2V0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXNlckRhdGEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1VzZXIoe1xyXG4gICAgICAgICAgICAgICAgLi4udmFsaWRGb3JnZXRQYXNzd29yZERhdGEsXHJcbiAgICAgICAgICAgICAgICBpc1RlbXBQYXNzd29yZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZENoYW5nZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbW9ja1VzZXIuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlckRhdGEgYXMgYW55KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tSZXEgPSB0ZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3QoeyBib2R5OiB2YWxpZEZvcmdldFBhc3N3b3JkRGF0YSB9KTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1JlcyA9IHRlc3RVdGlscy5jcmVhdGVNb2NrUmVzcG9uc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IGZvcmdldFBhc3N3b3JkKG1vY2tSZXEgYXMgYW55LCBtb2NrUmVzIGFzIGFueSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VzZXJEYXRhLnBhc3N3b3JkKS50b0JlKCdoYXNoZWRQYXNzd29yZCcpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VzZXJEYXRhLmlzVGVtcFBhc3N3b3JkKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VzZXJEYXRhLnBhc3N3b3JkQ2hhbmdlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tVc2VyRGF0YS5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9